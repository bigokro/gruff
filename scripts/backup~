#!/bin/bash

rsync -a --delete /home/ec2-user/gruff /var/local/backup/gruff
rsync -a --delete /home/ec2-user/redmine /var/local/backup/redmine
rsync -a --delete /home/git/gruff.git /var/local/backup/gruff.git
mysqldump -u backup -pZhBfUR47QxN83g2f redmine | gzip -c > /var/local/backup/redmine.sql.gz
mongodump -o /var/local/backup/mongodb
DATE=`date +%Y%m%d`
FILE=$DATE.backup.tgz
tar -czf /tmp/$FILE /var/local/backup
/opt/s3sync/s3cmd.rb put gruff_backup:$FILE /tmp/$FILE
rm /tmp/$FILE